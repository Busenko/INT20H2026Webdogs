INT20H2026Webdogs
Тестове завдання
Цей проєкт створено як розв'язання бізнес-проблеми для сервісу доставки дронами в штаті Нью-Йорк. Основна мета — автоматизувати розрахунок Composite Sales Tax для кожного замовлення на основі географічних координат (latitude/longitude) точки доставки.
Система дозволяє імпортувати дані з CSV файлу, створювати замовлення та переглядати результати в вигляді таблиці податкових нарахувань, маючи можливість застосовувати фільтри.
 Технологічний стек
Backend: PHP (чистий REST API) з використанням патернів Controller-Service-Gateway.
Database: MySQL (зберігання замовлень та податкових ставок).
Auth: JWT (JSON Web Token) для безпечного доступу до адмін-панелі.
Frontend: Vanilla JavaScript (модульна архітектура з компонентами).
Infrastructure: Docker & Docker Compose (Nginx + PHP-Apache + MySQL).
 Структура проєкту
Backend & Core
.
├── Dockerfile              # Конфігурація Docker для PHP-Apache
├── docker-compose.yml      # Координація сервісів (Backend, DB, Frontend)
├── index.php               # Точка входу API (Router)
├── .htaccess               # Налаштування перенаправлення запитів
├── .osp/                   # Конфігурація Open Server Panel
└── private/                # Приватна логіка застосунку
    ├── .env                # Налаштування оточення
    ├── composer.json       # PHP залежності
    ├── App/                # Основний код (Controllers, Models, Services)
    │   ├── Controllers/    # Обробка HTTP запитів
    │   ├── Core/           # Ядро системи (Database, Router)
    │   ├── Gateways/       # Робота з базою даних
    │   ├── Services/       # Складна бізнес-логіка розрахунків
    │   └── Resurses/       # GeoJSON дані та CSV шаблони
    └── base/               # SQL дамп бази даних (order_db.sql)


Frontend
frontend/
├── Dockerfile              # Конфігурація Docker для Nginx
├── index.html              # Основний файл інтерфейсу
└── src/
    ├── assets/             # Стилі (CSS)
    ├── components/         # Модульні компоненти (Table, Modal, Forms)
    ├── config/             # Налаштування API_URL (appConfig.js)
    ├── services/           # Модулі для зв'язку з API
    └── views/              # Логіка сторінок (Admin, Login)


 Архітектура та прийняті рішення
Згідно з порадами до завдання, основний фокус було зроблено на бізнес-логіці:
Гео-кодування та Юрисдикції: Оскільки податок у штаті Нью-Йорк залежить від конкретної адреси (штат + округ + місто + спеціальні зони) , у системі реалізовано сервіс JurisdictionService, який визначає ставку на основі вхідних координат.
Розділення відповідальності:
Gateways: Ізольована робота з SQL-запитами.
Services: Розрахунок податкових ставок (TaxCalculatorService) та обробка CSV файлів.
Validators: Жорстка перевірка вхідних даних (координати, суми) перед збереженням.
Налаштування та запуск
Варіант 1: Запуск через Docker (Рекомендовано)
Завдяки Docker вам не потрібно вручну налаштовувати сервер, PHP або базу даних.
Клонуйте репозиторій:
git clone [https://github.com/Busenko/INT20H2026Webdogs.git](https://github.com/Busenko/INT20H2026Webdogs.git)
cd INT20H2026Webdogs


Запустіть проєкт:
Виконайте команду в корені проєкту:
docker-compose up -d --build

Це автоматично збере образи, встановить залежності Composer та імпортує базу даних.
Доступ до застосунку:
Frontend: http://localhost:3000
Backend API: http://localhost:8080
Варіант 2: Ручне налаштування (Open Server)
Розміщення: Перемістіть вміст папки INT20H2026Webdogs у директорію локального сервера (наприклад: home/Webdogs).
Конфігурація Open Server (.osp):
У файлі .osp/project.ini:
[Webdogs]
php_engine = PHP-8.4


Залежності:
cd private
composer install


База даних:
Створіть базу order_db та імпортуйте private/base/order_db.sql. Налаштуйте private/.env.
Frontend:
У файлі frontend/src/config/appConfig.js вкажіть ваш URL (наприклад, http://webdogs). Відкрийте frontend/index.html через VS Code Live Server.
Авторизація (Admin Panel)
Уведіть дані, зазначені у файлі private/.env:
Логін: webdogs
Пароль: 0123webdogs-start
Податкові ставки та правила розрахунку
Логіка розрахунку composite_tax_rate базується на офіційних звітах Департаменту оподаткування та фінансів штату Нью-Йорк (NY State Department of Taxation and Finance).
Підготовка бази (TaxSeedService)
Початковим етапом є підготовка нормативної бази в сервісі TaxSeedService.php, який трансформує дані з офіційного звіту Департаменту оподаткування та фінансів штату Нью-Йорк (файл ny_taxes_2025.json) у структуровані правила. Під час цього процесу метод mapJsonToTaxData проводить декомпозицію загальної ставки: він виділяє базову державну частку в 4%, ідентифікує приналежність до спеціальних зон MCTD за допомогою списку $mctdZones (додаючи ставку 0.375%) та розраховує місцевий податок як залишок від загальної суми.
Визначення юрисдикції (JurisdictionService)
Операційна частина логіки активується в OrderCreationService.php, коли система отримує координати замовлення. Процес починається з виклику JurisdictionService.php, який завантажує просторові дані з Counties.json. Для забезпечення швидкодії сервіс спочатку проводить перевірку через calculateBBox (Bounding Box), щоб відсіяти точки, які завідомо не належать до округу, і лише після цього запускає складний математичний алгоритм isPointInPolygon.
Розрахунок та кешування (TaxCalculatorService)
Після визначення назви юрисдикції в справу вступає TaxCalculatorService.php, який шукає відповідні ставки в базі даних. Сервіс використовує статичний кеш $taxCache, щоб при масовому імпорту через CsvImportService.php система не перевантажувала базу даних повторними запитами для одних і тих самих округів.
Принцип Nexus
Завершальний етап бізнес-логіки полягає у фізичній прив'язці податку до замовлення. Проте, якщо замовлення має координати за межами полігонів Нью-Йорка, JurisdictionService повертає null. У такому випадку система, дотримуючись принципу податкового зв'язку (Nexus), припиняє нарахування: замовлення створюється з нульовим податком та без прив'язки до податкової ставки, оскільки податкові повноваження штату закінчуються на його географічній межі.
Джерела даних та інструменти
Географічні межі (Civil Boundaries): Дані про кордони округів взяти з офіційного геопорталу gis.ny.gov.
Mapshaper: Використано для проектування (-proj wgs84) та конвертації Shapefile у GeoJSON.
Податкові ставки: На основі офіційної Публікації 718 Департаменту оподаткування NY.
